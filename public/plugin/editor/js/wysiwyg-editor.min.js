!function(window,document,$,undefined){"use strict";var HSVtoRGB=function(h,s,v){var r,g,b,i,f,p,q,t;switch(i=Math.floor(6*h),f=6*h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}var hr=Math.floor(255*r).toString(16),hg=Math.floor(255*g).toString(16),hb=Math.floor(255*b).toString(16);return"#"+(hr.length<2?"0":"")+hr+(hg.length<2?"0":"")+hg+(hb.length<2?"0":"")+hb},create_editor=function($textarea,classes,placeholder,toolbar_position,toolbar_buttons,toolbar_submit,label_dropfileclick,placeholder_url,max_imagesize,onImageUpload,onKeyEnter){var wysiwygeditor_insertLink=function(wysiwygeditor,url){if(!url)return wysiwygeditor;var selectedhtml=wysiwygeditor.getSelectedHTML();if(selectedhtml)return wysiwygeditor.insertLink(url);var html='<a href="'+url.replace(/"/,"&quot;")+'">'+url+"</a>";return wysiwygeditor.insertHTML(html)},content_insertlink=function(wysiwygeditor,$modify_link){var $button=toolbar_button(toolbar_submit),$inputurl=$('<input type="text" value="'+($modify_link?$modify_link.attr("href"):"")+'"'+(placeholder_url?' placeholder="'+placeholder_url+'"':"")+" />").addClass("wysiwyg-input").keypress(function(event){if(10==event.which||13==event.which)if($modify_link)$modify_link.attr("href",$inputurl.val()),wysiwygeditor.closePopup().collapseSelection();else try{wysiwygeditor_insertLink(wysiwygeditor,$inputurl.val()).closePopup().collapseSelection()}catch(e){wysiwygeditor.closePopup()}}),$okaybutton=$button.click(function(event){return $modify_link?($modify_link.attr("href",$inputurl.val()),wysiwygeditor.closePopup().collapseSelection()):wysiwygeditor_insertLink(wysiwygeditor,$inputurl.val()).closePopup().collapseSelection(),event.stopPropagation(),event.preventDefault(),!1}),$content=$("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");return $content.append($inputurl).append($okaybutton),$content},content_insertimage=function(wysiwygeditor){var insert_image_wysiwyg=function(url,filename){var html='<img id="wysiwyg-insert-image" src="" alt=""'+(filename?' title="'+filename.replace(/"/,"&quot;")+'"':"")+" />";wysiwygeditor.insertHTML(html).closePopup().collapseSelection();var $image=$("#wysiwyg-insert-image").removeAttr("id");max_imagesize&&$image.css({maxWidth:max_imagesize[0]+"px",maxHeight:max_imagesize[1]+"px"}).load(function(){$image.css({maxWidth:"",maxHeight:""});var image_width=$image.width(),image_height=$image.height();(image_width>max_imagesize[0]||image_height>max_imagesize[1])&&(image_width/image_height>max_imagesize[0]/max_imagesize[1]?(image_height=parseInt(image_height/image_width*max_imagesize[0]),image_width=max_imagesize[0]):(image_width=parseInt(image_width/image_height*max_imagesize[1]),image_height=max_imagesize[1]),$image.attr("width",image_width).attr("height",image_height))}),$image.attr("src",url)},$content=$("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on"),$fileuploader=null;if(onImageUpload){var $input=$('<input type="file" name="picture" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"}).change(function(event){onImageUpload.call(this,insert_image_wysiwyg)});$fileuploader=$("<form/>").append($input)}else if(window.File&&window.FileReader&&window.FileList){var loadImageFromFile=function(file){if(file.type.match("image.*")){var reader=new FileReader;reader.onload=function(event){var dataurl=event.target.result;insert_image_wysiwyg(dataurl,file.name)},reader.readAsDataURL(file)}};$fileuploader=$('<input type="file" />').attr("draggable","true").css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"}).change(function(event){for(var files=event.target.files,i=0;i<files.length;++i)loadImageFromFile(files[i])}).on("dragover",function(event){return event.originalEvent.dataTransfer.dropEffect="copy",event.stopPropagation(),event.preventDefault(),!1}).on("drop",function(event){for(var files=event.originalEvent.dataTransfer.files,i=0;i<files.length;++i)loadImageFromFile(files[i]);return event.stopPropagation(),event.preventDefault(),!1})}$fileuploader&&$("<div/>").addClass("wysiwyg-browse").html(label_dropfileclick).append($fileuploader).appendTo($content);var $button=toolbar_button(toolbar_submit),$inputurl=$('<input type="text" value=""'+(placeholder_url?' placeholder="'+placeholder_url+'"':"")+" />").addClass("wysiwyg-input").keypress(function(event){10!=event.which&&13!=event.which||insert_image_wysiwyg($inputurl.val())}),$okaybutton=$button.click(function(event){return insert_image_wysiwyg($inputurl.val()),event.stopPropagation(),event.preventDefault(),!1});return $content.append($("<div/>").append($inputurl).append($okaybutton)),$content},content_colorpalette=function(wysiwygeditor,forecolor){for(var $content=$("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on"),row=1;15>row;++row){for(var $rows=$("<tr/>"),col=0;25>col;++col){var color;if(24==col){var gray=Math.floor(255/13*(14-row)).toString(16),hexg=(gray.length<2?"0":"")+gray;color="#"+hexg+hexg+hexg}else{var hue=col/24,saturation=8>=row?row/8:1,value=row>8?(16-row)/8:1;color=HSVtoRGB(hue,saturation,value)}$("<td/>").addClass("wysiwyg-toolbar-color").attr("title",color).attr("unselectable","on").css({backgroundColor:color}).click(function(){var color=this.title;return forecolor?wysiwygeditor.forecolor(color).closePopup().collapseSelection():wysiwygeditor.highlight(color).closePopup().collapseSelection(),!1}).appendTo($rows)}$content.append($rows)}return $content},get_toolbar_handler=function(name,popup_callback){switch(name){case"insertimage":return popup_callback?function(target){popup_callback(content_insertimage(wysiwygeditor),target)}:null;case"insertlink":return popup_callback?function(target){popup_callback(content_insertlink(wysiwygeditor),target)}:null;case"bold":return function(){wysiwygeditor.bold()};case"italic":return function(){wysiwygeditor.italic()};case"underline":return function(){wysiwygeditor.underline()};case"strikethrough":return function(){wysiwygeditor.strikethrough()};case"forecolor":return popup_callback?function(target){popup_callback(content_colorpalette(wysiwygeditor,!0),target)}:null;case"highlight":return popup_callback?function(target){popup_callback(content_colorpalette(wysiwygeditor,!1),target)}:null;case"alignleft":return function(){wysiwygeditor.align("left")};case"aligncenter":return function(){wysiwygeditor.align("center")};case"alignright":return function(){wysiwygeditor.align("right")};case"alignjustify":return function(){wysiwygeditor.align("justify")};case"subscript":return function(){wysiwygeditor.subscript()};case"superscript":return function(){wysiwygeditor.superscript()};case"indent":return function(){wysiwygeditor.indent()};case"outdent":return function(){wysiwygeditor.indent(!0)};case"orderedList":return function(){wysiwygeditor.insertList(!0)};case"unorderedList":return function(){wysiwygeditor.insertList()};case"removeformat":return function(){wysiwygeditor.removeFormat().closePopup().collapseSelection()}}return null},toolbar_button=function(button){return $("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",button.title).attr("unselectable","on").append(button.image)},add_buttons_to_toolbar=function($toolbar,selection,popup_open_callback,popup_position_callback){$.each(toolbar_buttons,function(key,value){if(value&&(!(selection===!1&&"showstatic"in value)||value.showstatic)&&(!(selection===!0&&"showselection"in value)||value.showselection)){var toolbar_handler;toolbar_handler="click"in value?function(target){value.click($(target))}:"popup"in value?function(target){var $popup=popup_open_callback(),apply_position=value.popup($popup,$(target));apply_position!==!1&&popup_position_callback($popup,target)}:get_toolbar_handler(key,function($content,target){var $popup=popup_open_callback();$popup.append($content),popup_position_callback($popup,target),$popup.find("input[type=text]:first").focus()});var $button;toolbar_handler?$button=toolbar_button(value).click(function(event){return toolbar_handler(event.currentTarget),get_toolbar_handler(key)&&wysiwygeditor.getElement().focus(),event.stopPropagation(),event.preventDefault(),!1}):value.html&&($button=$(value.html)),$button&&$toolbar.append($button)}})},fixed_parent=function(){var parent_fixed=!1;return $(wysiwygeditor.getElement()).parents().each(function(index,element){return"fixed"==$(element).css("position")?(parent_fixed=!0,!1):void 0}),parent_fixed},fixed_offset=function($element){for(var offset={left:0,top:0},node=$element.get(0);node;)offset.left+=node.offsetLeft,offset.top+=node.offsetTop,node=node.offsetParent;return offset},hotkeys={},create_wysiwyg=function($textarea,$container,placeholder){var option={element:$textarea.get(0),onkeypress:function(code,character,shiftKey,altKey,ctrlKey,metaKey){if(onKeyEnter&&(10==code||13==code)&&!shiftKey&&!altKey&&!ctrlKey&&!metaKey)return onKeyEnter.call(wysiwygeditor.getElement());if(character&&!shiftKey&&!altKey&&ctrlKey&&!metaKey){var hotkey=character.toLowerCase();if(!hotkeys[hotkey])return;return hotkeys[hotkey](),!1}},onselection:function(collapsed,rect,nodes,rightclick){var show_toolbar=!0,$special_toolbar=null;if(1==nodes.length&&0!=$(nodes[0]).parents("a").length?$special_toolbar=content_insertlink(wysiwygeditor,$(nodes[0]).parents("a:first")):rightclick||("selection"!=toolbar_position&&"top-selection"!=toolbar_position&&"bottom-selection"!=toolbar_position?show_toolbar=!1:rect===undefined||collapsed?show_toolbar=!1:1==nodes.length&&"IMG"==nodes[0].nodeName&&(show_toolbar=!1)),!show_toolbar)return void wysiwygeditor.closePopup();var $toolbar,apply_toolbar_position=function(){var offset=fixed_offset($(wysiwygeditor.getElement())),toolbar_width=$toolbar.outerWidth(),left=offset.left+rect.left+parseInt(rect.width/2)-parseInt(toolbar_width/2),top=offset.top+rect.top+rect.height,viewport_width=$(window).width();left+toolbar_width>viewport_width-1&&(left=viewport_width-toolbar_width-1);var scroll_left=fixed_parent()?0:$(window).scrollLeft();scroll_left+1>left&&(left=scroll_left+1),$toolbar.css({left:left+"px",top:top+"px",overflow:"visible"})};$toolbar=$(wysiwygeditor.openPopup()),$toolbar.hasClass("wysiwyg-popup")&&!$toolbar.hasClass("wysiwyg-arrowtop")&&($toolbar=$(wysiwygeditor.closePopup().openPopup())),$toolbar.hasClass("wysiwyg-popup")||($toolbar.addClass("wysiwyg-popup wysiwyg-arrowtop").css("position",fixed_parent()?"fixed":"absolute"),$special_toolbar?$toolbar.empty().append($special_toolbar):add_buttons_to_toolbar($toolbar,!0,function(){return $toolbar.empty()},function($popup){apply_toolbar_position()})),apply_toolbar_position()},hijackcontextmenu:"selection"==toolbar_position};if(placeholder){var $placeholder=$("<div/>").addClass("wysiwyg-placeholder").html(placeholder).hide();$container.prepend($placeholder),option.onplaceholder=function(visible){visible?$placeholder.show():$placeholder.hide()}}var wysiwygeditor=wysiwyg(option);return wysiwygeditor},$container=$("<div/>").addClass("wysiwyg-container");classes&&$container.addClass(classes),$textarea.wrap($container),$container=$textarea.parent(".wysiwyg-container");var $wrapper=!1;placeholder&&($wrapper=$("<div/>").addClass("wysiwyg-wrapper").click(function(){wysiwygeditor.getElement().focus()}),$textarea.wrap($wrapper),$wrapper=$textarea.parent(".wysiwyg-wrapper"));var wysiwygeditor=create_wysiwyg($textarea,placeholder?$wrapper:$container,placeholder);if(wysiwygeditor.legacy){var $textarea=$(wysiwygeditor.getElement());$textarea.addClass("wysiwyg-textarea"),$textarea.is(":visible")&&$textarea.width($container.width()-($textarea.outerWidth()-$textarea.width()))}else $(wysiwygeditor.getElement()).addClass("wysiwyg-editor");var commands={};if($.each(toolbar_buttons,function(key,value){if(value&&value.hotkey){var toolbar_handler=get_toolbar_handler(key);toolbar_handler&&(hotkeys[value.hotkey.toLowerCase()]=toolbar_handler,commands[key]=toolbar_handler)}}),"selection"!=toolbar_position){var toolbar_top="top"==toolbar_position||"top-selection"==toolbar_position,$toolbar=$("<div/>").addClass("wysiwyg-toolbar").addClass(toolbar_top?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");add_buttons_to_toolbar($toolbar,!1,function(){var $popup=$(wysiwygeditor.openPopup());return $popup.hasClass("wysiwyg-popup")&&$popup.hasClass("wysiwyg-arrowtop")&&($popup=$(wysiwygeditor.closePopup().openPopup())),$popup.hasClass("wysiwyg-popup")||$popup.addClass("wysiwyg-popup").css("position",fixed_parent()?"fixed":"absolute"),$popup},function($popup,target){var $button=$(target),popup_width=$popup.outerWidth(),offset=fixed_offset($button),left=offset.left+parseInt($button.width()/2)-parseInt(popup_width/2),top=offset.top;toolbar_top?top+=$button.outerHeight():top-=$popup.height();var viewport_width=$(window).width();left+popup_width>viewport_width-1&&(left=viewport_width-popup_width-1);var scroll_left=fixed_parent()?0:$(window).scrollLeft();scroll_left+1>left&&(left=scroll_left+1),$popup.css({left:left+"px",top:top+"px",overflow:"visible"})}),toolbar_top?$container.prepend($toolbar):$container.append($toolbar)}return{wysiwygeditor:wysiwygeditor,$container:$container}};$.fn.wysiwyg=function(option,param){if(!option||"object"==typeof option)return option=$.extend({},option),this.each(function(){var $that=$(this);if(!$that.data("wysiwyg")){var classes=option.classes,placeholder=option.placeholder||$that.attr("placeholder"),toolbar_position=!option.toolbar||"top"!=option.toolbar&&"top-selection"!=option.toolbar&&"bottom"!=option.toolbar&&"bottom-selection"!=option.toolbar&&"selection"!=option.toolbar?"top-selection":option.toolbar,toolbar_buttons=option.buttons,toolbar_submit=option.submit,label_dropfileclick=option.dropfileclick,placeholder_url=option.placeholderUrl||null,max_imagesize=option.maxImageSize||null,onImageUpload=option.onImageUpload,onKeyEnter=option.onKeyEnter,data=create_editor($that,classes,placeholder,toolbar_position,toolbar_buttons,toolbar_submit,label_dropfileclick,placeholder_url,max_imagesize,onImageUpload,onKeyEnter);$that.data("wysiwyg",data)}});if(1==this.length){var data=this.data("wysiwyg");if(!data)return this;if("container"==option)return data.$container;if("shell"==option)return data.wysiwygeditor}return this}}(window,document,jQuery);