!function(window,document,navigator,undefined){"use strict";var debounce=function(callback,wait,cancelprevious){var timeout;return function(){if(timeout){if(!cancelprevious)return;clearTimeout(timeout)}var context=this,args=arguments;timeout=setTimeout(function(){timeout=null,callback.apply(context,args)},wait)}},addEvent=function(element,type,handler){element.addEventListener?element.addEventListener(type,handler,!1):element.attachEvent?element.attachEvent("on"+type,handler):element!=window&&(element["on"+type]=handler)},removeEvent=function(element,type,handler){element.removeEventListener?element.removeEventListener(type,handler,!1):element.detachEvent?element.detachEvent("on"+type,handler):element!=window&&(element["on"+type]=null)},fireEvent=function(obj,evt,bubbles,cancelable){if(document.createEvent){var event=document.createEvent("Event");event.initEvent(evt,bubbles!==undefined?bubbles:!0,cancelable!==undefined?cancelable:!1),obj.dispatchEvent(event)}else if(document.createEventObject){var event=document.createEventObject();obj.fireEvent("on"+evt,event)}else"function"==typeof element["on"+type]&&element["on"+type]()},cancelEvent=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1},Node_ELEMENT_NODE="undefined"!=typeof Node?Node.ELEMENT_NODE:1,Node_TEXT_NODE="undefined"!=typeof Node?Node.TEXT_NODE:3,isOrContainsNode=function(ancestor,descendant){for(var node=descendant;node;){if(node===ancestor)return!0;node=node.parentNode}return!1},nextNode=function(node,container){if(node.firstChild)return node.firstChild;for(;node;){if(node==container)return null;if(node.nextSibling)return node.nextSibling;node=node.parentNode}return null},saveSelection=function(containerNode){if(window.getSelection){var sel=window.getSelection();if(sel.rangeCount>0)return sel.getRangeAt(0)}else if(document.selection){var sel=document.selection;return sel.createRange()}return null},restoreSelection=function(containerNode,savedSel){if(savedSel)if(window.getSelection){var sel=window.getSelection();sel.removeAllRanges(),sel.addRange(savedSel)}else document.selection&&savedSel.select()},getSelectionRect=function(){if(window.getSelection){var sel=window.getSelection();if(!sel.rangeCount)return!1;var range=sel.getRangeAt(0).cloneRange();if(range.getBoundingClientRect){var rect=range.getBoundingClientRect();return!rect||0==rect.left&&0==rect.top&&0==rect.right&&0==rect.bottom?!1:{left:parseInt(rect.left),top:parseInt(rect.top),width:parseInt(rect.right-rect.left),height:parseInt(rect.bottom-rect.top)}}}else if(document.selection){var sel=document.selection;if("Control"!=sel.type){var range=sel.createRange();return{left:range.boundingLeft,top:range.boundingTop,width:range.boundingWidth,height:range.boundingHeight}}}return!1},getSelectionCollapsed=function(containerNode){if(window.getSelection){var sel=window.getSelection();return!!sel.isCollapsed}if(document.selection){var sel=document.selection;if("Text"==sel.type){var range=document.selection.createRange(),textrange=document.body.createTextRange();return textrange.moveToElementText(containerNode),textrange.setEndPoint("EndToStart",range),0==range.htmlText.length}if("Control"==sel.type)return!1}return!0},getSelectedNodes=function(containerNode){if(window.getSelection){var sel=window.getSelection();if(!sel.rangeCount)return[];for(var nodes=[],i=0;i<sel.rangeCount;++i)for(var range=sel.getRangeAt(i),node=range.startContainer,endNode=range.endContainer;node;){if(node!=containerNode){var node_inside_selection=!1;if(sel.containsNode)node_inside_selection=sel.containsNode(node,!0);else{var noderange=document.createRange();noderange.selectNodeContents(node);for(var i=0;i<sel.rangeCount;++i){var range=sel.getRangeAt(i);if(range.compareBoundaryPoints(range.START_TO_START,noderange)<=0&&range.compareBoundaryPoints(range.END_TO_END,noderange)>=0){node_inside_selection=!0;break}}}node_inside_selection&&nodes.push(node)}node=nextNode(node,node==endNode?endNode:containerNode)}return 0==nodes.length&&isOrContainsNode(containerNode,sel.focusNode)&&sel.focusNode!=containerNode&&nodes.push(sel.focusNode),nodes}if(document.selection){var sel=document.selection;if("Text"==sel.type){for(var nodes=[],range=sel.createRange(),node=containerNode;node;){if(node!=containerNode&&node.nodeType==Node_ELEMENT_NODE){var noderange=range.duplicate();noderange.moveToElementText(node),range.inRange(noderange)&&nodes.push(node)}node=nextNode(node,containerNode)}return 0==nodes.length&&isOrContainsNode(containerNode,document.activeElement)&&document.activeElement!=containerNode&&nodes.push(document.activeElement),nodes}if("Control"==sel.type){for(var nodes=[],range=sel.createRange(),i=0;i<range.length;++i)nodes.push(range(i));return nodes}}return[]},collapseSelectionEnd=function(){if(window.getSelection){var sel=window.getSelection();sel.isCollapsed||sel.collapseToEnd()}else if(document.selection){var sel=document.selection;if("Control"!=sel.type){var range=sel.createRange();range.collapse(!1),range.select()}}},getSelectionHtml=function(containerNode){if(getSelectionCollapsed(containerNode))return null;if(window.getSelection){var sel=window.getSelection();if(sel.rangeCount){for(var container=document.createElement("div"),len=sel.rangeCount,i=0;len>i;++i){var contents=sel.getRangeAt(i).cloneContents();container.appendChild(contents)}return container.innerHTML}}else if(document.selection){var sel=document.selection;if("Text"==sel.type){var range=sel.createRange();return range.htmlText}}return null},selectionInside=function(containerNode,force){if(window.getSelection){var sel=window.getSelection();if(isOrContainsNode(containerNode,sel.anchorNode)&&isOrContainsNode(containerNode,sel.focusNode))return!0;if(!force)return!1;var range=document.createRange();range.selectNodeContents(containerNode),range.collapse(!1),sel.removeAllRanges(),sel.addRange(range)}else if(document.selection){var sel=document.selection;if("Control"==sel.type){var range=sel.createRange();if(0!=range.length&&isOrContainsNode(containerNode,range(0)))return!0}else{var rangeContainer=document.body.createTextRange();rangeContainer.moveToElementText(containerNode);var range=sel.createRange();if(rangeContainer.inRange(range))return!0}if(!force)return!1;var range=document.body.createTextRange();range.moveToElementText(containerNode),range.setEndPoint("StartToEnd",range),range.select()}return!0},pasteHtmlAtCaret=function(containerNode,html){if(window.getSelection){var sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount){var range=sel.getRangeAt(0),el=document.createElement("div");el.innerHTML=html;for(var node,lastNode,frag=document.createDocumentFragment();node=el.firstChild;)lastNode=frag.appendChild(node);isOrContainsNode(containerNode,range.commonAncestorContainer)?(range.deleteContents(),range.insertNode(frag)):containerNode.appendChild(frag),lastNode&&(range=range.cloneRange(),range.setStartAfter(lastNode),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}}else if(document.selection){var sel=document.selection;if("Control"!=sel.type){var originalRange=sel.createRange();originalRange.collapse(!0);var range=sel.createRange();if(isOrContainsNode(containerNode,range.parentElement()))range.pasteHTML(html);else{var textRange=document.body.createTextRange();textRange.moveToElementText(containerNode),textRange.collapse(!1),textRange.select(),textRange.pasteHTML(html)}range=sel.createRange(),range.setEndPoint("StartToEnd",originalRange),range.select()}}};window.wysiwyg=function(option){option=option||{};var option_element=option.element||null,option_onkeypress=option.onkeypress||null,option_onselection=option.onselection||null,option_onplaceholder=option.onplaceholder||null,option_hijackcontextmenu=option.hijackcontextmenu||!1,is_textarea="TEXTAREA"==option_element.nodeName||"INPUT"==option_element.nodeName;if(is_textarea){var canContentEditable="contentEditable"in document.body;if(canContentEditable){var webkit=navigator.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);webkit&&420<=parseInt(webkit[1])&&parseInt(webkit[1])<534&&(canContentEditable=!1)}if(!canContentEditable){var node_textarea=option_element,newlineAfterBR=function(html){return html.replace(/<br[ \/]*>\n?/gi,"<br>\n")};node_textarea.value=newlineAfterBR(node_textarea.value);var dummy_this=function(){return this},dummy_null=function(){return null};return{legacy:!0,getElement:function(){return node_textarea},getHTML:function(){return node_textarea.value},setHTML:function(html){return node_textarea.value=newlineAfterBR(html),this},getSelectedHTML:dummy_null,collapseSelection:dummy_this,openPopup:dummy_null,closePopup:dummy_this,removeFormat:dummy_this,bold:dummy_this,italic:dummy_this,underline:dummy_this,strikethrough:dummy_this,forecolor:dummy_this,highlight:dummy_this,fontName:dummy_this,fontSize:dummy_this,subscript:dummy_this,superscript:dummy_this,align:dummy_this,format:dummy_this,indent:dummy_this,insertLink:dummy_this,insertImage:dummy_this,insertHTML:dummy_this,insertList:dummy_this}}}var node_textarea=null,node_wysiwyg=null;is_textarea?(node_textarea=option_element,node_textarea.style.display="none",node_wysiwyg=document.createElement("DIV"),node_wysiwyg.innerHTML=node_textarea.value,node_textarea.parentNode.insertBefore(node_wysiwyg,node_textarea.nextSibling)):node_wysiwyg=option_element,node_wysiwyg.setAttribute("contentEditable","true");var window_ie8=document.all&&!document.addEventListener?document:window,syncTextarea=null;if(is_textarea){var previous_html=node_wysiwyg.innerHTML;syncTextarea=function(){var new_html=node_wysiwyg.innerHTML;new_html!=previous_html&&(node_textarea.value=new_html,previous_html=new_html,fireEvent(node_textarea,"change",!1))}}var showPlaceholder;if(option_onplaceholder){var placeholder_visible=!1;showPlaceholder=function(){for(var wysiwyg_empty=!0,node=node_wysiwyg;node;)if(node=nextNode(node,node_wysiwyg)){if(node.nodeType==Node_ELEMENT_NODE){if("IMG"==node.nodeName){wysiwyg_empty=!1;break}}else if(node.nodeType==Node_TEXT_NODE){var text=node.nodeValue;if(text&&-1!=text.search(/[^\s]/)){wysiwyg_empty=!1;break}}}else;placeholder_visible!=wysiwyg_empty&&(option_onplaceholder(wysiwyg_empty),placeholder_visible=wysiwyg_empty)},showPlaceholder()}var popup_saved_selection=null,handleSelection=null,debounced_handleSelection=null;option_onselection&&(handleSelection=function(clientX,clientY,rightclick){var collapsed=getSelectionCollapsed(node_wysiwyg),nodes=getSelectedNodes(node_wysiwyg),rect=null===clientX||null===clientY?null:{left:clientX,top:clientY,width:0,height:0},selectionRect=getSelectionRect();if(selectionRect&&(rect=selectionRect),rect){if(node_wysiwyg.getBoundingClientRect){var boundingrect=node_wysiwyg.getBoundingClientRect();rect.left-=parseInt(boundingrect.left),rect.top-=parseInt(boundingrect.top)}else{var node=node_wysiwyg,offsetLeft=0,offsetTop=0,fixed=!1;do offsetLeft+=node.offsetLeft?parseInt(node.offsetLeft):0,offsetTop+=node.offsetTop?parseInt(node.offsetTop):0,"fixed"==node.style.position&&(fixed=!0);while(node=node.offsetParent);rect.left-=offsetLeft-(fixed?0:window.pageXOffset),rect.top-=offsetTop-(fixed?0:window.pageYOffset)}rect.left<0&&(rect.left=0),rect.top<0&&(rect.top=0),rect.width>node_wysiwyg.offsetWidth&&(rect.width=node_wysiwyg.offsetWidth),rect.height>node_wysiwyg.offsetHeight&&(rect.height=node_wysiwyg.offsetHeight)}else if(nodes.length)for(var i=0;i<nodes.length;++i){var node=nodes[i];if(node.nodeType==Node_ELEMENT_NODE){rect={left:node.offsetLeft,top:node.offsetTop,width:node.offsetWidth,height:node.offsetHeight};break}}option_onselection(collapsed,rect,nodes,rightclick)},debounced_handleSelection=debounce(handleSelection,1));var node_popup=null,popupClickClose=function(e){if(!e)var e=window.event;var target=e.target||e.srcElement;target.nodeType==Node_TEXT_NODE&&(target=target.parentNode),isOrContainsNode(node_popup,target)||popupClose()},popupOpen=function(){return node_popup?node_popup:(addEvent(window_ie8,"mousedown",popupClickClose),node_popup=document.createElement("DIV"),document.body.appendChild(node_popup),node_popup)},popupClose=function(){node_popup&&(node_popup.parentNode.removeChild(node_popup),node_popup=null,removeEvent(window_ie8,"mousedown",popupClickClose))};addEvent(node_wysiwyg,"focus",function(){node_textarea&&fireEvent(node_textarea,"focus",!1)}),addEvent(node_wysiwyg,"blur",function(){syncTextarea&&syncTextarea(),node_textarea&&fireEvent(node_textarea,"blur",!1)});var debounced_changeHandler=null;if(showPlaceholder||syncTextarea){var debounced_syncTextarea=syncTextarea?debounce(syncTextarea,50,!0):null,changeHandler=function(e){showPlaceholder&&showPlaceholder(),debounced_syncTextarea&&debounced_syncTextarea()};debounced_changeHandler=debounce(changeHandler,1),addEvent(node_wysiwyg,"input",debounced_changeHandler),addEvent(node_wysiwyg,"DOMNodeInserted",debounced_changeHandler),addEvent(node_wysiwyg,"DOMNodeRemoved",debounced_changeHandler),addEvent(node_wysiwyg,"DOMSubtreeModified",debounced_changeHandler),addEvent(node_wysiwyg,"DOMCharacterDataModified",debounced_changeHandler),addEvent(node_wysiwyg,"propertychange",debounced_changeHandler),addEvent(node_wysiwyg,"textInput",debounced_changeHandler),addEvent(node_wysiwyg,"paste",debounced_changeHandler),addEvent(node_wysiwyg,"cut",debounced_changeHandler),addEvent(node_wysiwyg,"drop",debounced_changeHandler)}var keyHandler=function(e,phase){if(!e)var e=window.event;var code=0;e.keyCode?code=e.keyCode:e.which&&(code=e.which);var character=e.charCode;if(1==phase&&option_onkeypress){var rv=option_onkeypress(code,character?String(String):String.fromCharCode(code),e.shiftKey||!1,e.altKey||!1,e.ctrlKey||!1,e.metaKey||!1);if(rv===!1)return cancelEvent(e)}if(2!=phase&&3!=phase||(popup_saved_selection=null,debounced_handleSelection&&debounced_handleSelection(null,null,!1)),2==phase&&debounced_changeHandler)switch(code){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:debounced_changeHandler()}};addEvent(node_wysiwyg,"keydown",function(e){return keyHandler(e,1)}),addEvent(node_wysiwyg,"keypress",function(e){return keyHandler(e,2)}),addEvent(node_wysiwyg,"keyup",function(e){return keyHandler(e,3)});var mouseHandler=function(e,rightclick){if(!e)var e=window.event;var clientX=null,clientY=null;e.clientX&&e.clientY?(clientX=e.clientX,clientY=e.clientY):e.pageX&&e.pageY&&(clientX=e.pageX-window.pageXOffset,clientY=e.pageY-window.pageYOffset),e.which&&3==e.which?rightclick=!0:e.button&&2==e.button&&(rightclick=!0),removeEvent(window_ie8,"mouseup",mouseHandler),popup_saved_selection=null,!option_hijackcontextmenu&&rightclick||debounced_handleSelection&&debounced_handleSelection(clientX,clientY,rightclick)};addEvent(node_wysiwyg,"mousedown",function(e){removeEvent(window_ie8,"mouseup",mouseHandler),addEvent(window_ie8,"mouseup",mouseHandler)}),addEvent(node_wysiwyg,"mouseup",function(e){mouseHandler(e),debounced_changeHandler&&debounced_changeHandler()}),addEvent(node_wysiwyg,"dblclick",function(e){mouseHandler(e)}),addEvent(node_wysiwyg,"selectionchange",function(e){mouseHandler(e)}),option_hijackcontextmenu&&addEvent(node_wysiwyg,"contextmenu",function(e){return mouseHandler(e,!0),cancelEvent(e)});var execCommand=function(command,param,force_selection){if(restoreSelection(node_wysiwyg,popup_saved_selection),!selectionInside(node_wysiwyg,force_selection))return!1;if(window.getSelection)try{return document.queryCommandSupported&&!document.queryCommandSupported(command)?!1:document.execCommand(command,!1,param)}catch(e){}else if(document.selection){var sel=document.selection;if("None"!=sel.type){var range=sel.createRange();try{return range.queryCommandEnabled(command)?range.execCommand(command,!1,param):!1}catch(e){}}}return!1},callUpdates=function(selection_destroyed){showPlaceholder&&showPlaceholder(),syncTextarea&&syncTextarea(),selection_destroyed?(collapseSelectionEnd(),popup_saved_selection=null):popup_saved_selection&&(popup_saved_selection=saveSelection(node_wysiwyg))};return{getElement:function(){return node_wysiwyg},getHTML:function(){return node_wysiwyg.innerHTML},setHTML:function(html){return node_wysiwyg.innerHTML=html,callUpdates(!0),this},getSelectedHTML:function(){return restoreSelection(node_wysiwyg,popup_saved_selection),selectionInside(node_wysiwyg)?getSelectionHtml(node_wysiwyg):null},collapseSelection:function(){return collapseSelectionEnd(),popup_saved_selection=null,this},openPopup:function(){return popup_saved_selection||(popup_saved_selection=saveSelection(node_wysiwyg)),popupOpen()},closePopup:function(){return popupClose(),this},removeFormat:function(){return execCommand("removeFormat"),execCommand("unlink"),callUpdates(),this},bold:function(){return execCommand("bold"),callUpdates(),this},italic:function(){return execCommand("italic"),callUpdates(),this},underline:function(){return execCommand("underline"),callUpdates(),this},strikethrough:function(){return execCommand("strikeThrough"),callUpdates(),this},forecolor:function(color){return execCommand("foreColor",color),callUpdates(),this},highlight:function(color){return execCommand("hiliteColor",color)||execCommand("backColor",color),callUpdates(),this},fontName:function(name){return execCommand("fontName",name),callUpdates(),this},fontSize:function(size){return execCommand("fontSize",size),callUpdates(),this},subscript:function(){return execCommand("subscript"),callUpdates(),this},superscript:function(){return execCommand("superscript"),callUpdates(),this},align:function(align){return"left"==align?execCommand("justifyLeft"):"center"==align?execCommand("justifyCenter"):"right"==align?execCommand("justifyRight"):"justify"==align&&execCommand("justifyFull"),callUpdates(),this},format:function(tagname){return execCommand("formatBlock",tagname),callUpdates(),this},indent:function(outdent){return execCommand(outdent?"outdent":"indent"),callUpdates(),this},insertLink:function(url){return execCommand("createLink",url),callUpdates(!0),this},insertImage:function(url){return execCommand("insertImage",url,!0),callUpdates(!0),this},insertHTML:function(html){return execCommand("insertHTML",html,!0)||(restoreSelection(node_wysiwyg,popup_saved_selection),selectionInside(node_wysiwyg,!0),pasteHtmlAtCaret(node_wysiwyg,html)),callUpdates(!0),this},insertList:function(ordered){return execCommand(ordered?"insertOrderedList":"insertUnorderedList"),callUpdates(),this}}}}(window,document,navigator);